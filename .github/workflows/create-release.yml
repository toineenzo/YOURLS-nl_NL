name: Create nl_NL Release

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Verify files exist
        run: |
          test -f "nl_NL.po" || (echo "Missing nl_NL.po" && exit 1)
          test -f "nl_NL.mo" || (echo "Missing nl_NL.mo" && exit 1)

      - name: Extract metadata from nl_NL.po
        id: meta
        run: |
          PROJECT_ID=$(grep -m1 'Project-Id-Version:' nl_NL.po | sed 's/.*: "\(.*\)".*/\1/')
          REV_DATE=$(grep -m1 'PO-Revision-Date:' nl_NL.po | sed 's/.*: "\(....-..-..\).*/\1/')

          TAG="${PROJECT_ID}_${REV_DATE}"
          TITLE="${PROJECT_ID} â€“ ${REV_DATE}"

          echo "tag=$TAG" >> $GITHUB_OUTPUT
          echo "title=$TITLE" >> $GITHUB_OUTPUT

      - name: Create zip file
        run: |
          ZIP_NAME="nl_NL_${{ steps.meta.outputs.tag }}.zip"
          zip -j "$ZIP_NAME" nl_NL.po nl_NL.mo
          echo "zip=$ZIP_NAME" >> $GITHUB_ENV

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.meta.outputs.tag }}
          name: ${{ steps.meta.outputs.title }}
          files: ${{ env.zip }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
